import pandas as pd
import numpy as np
import math as m
import matplotlib.pylab as plt

#Reading .data file and coverting it to dataframe with delimiter as '\t'
df = pd.read_csv("onlyhash.data", sep="\t", names=['user','time','hashtag'])

uniqueDate = df['time'].unique()

#---------Calculating system entropy----------------------
listSystemEntropy = []

#Grouping the dataframe based on date and iterating over it
for i, newdf in df.groupby(['time']):
    entropy = 0
    time = newdf['time'].unique()
    tagList = newdf['hashtag'].unique()

    #Total number of meme measured for a day
    N = newdf['time'].__len__()

    #Iterating over all the hashtags for a particular date
    for tag in tagList:
        #count of a particular meme for a day
        ci = newdf[newdf['hashtag'] == tag].__len__()

        #calculating entropy for c(i) != 0
        if ci != 0:
            #proportion of a meme in a day
            fi = ci / N
            #measuring system entropy
            s = -(fi * m.log10(fi))

            entropy = entropy + s

    listSystemEntropy.append(entropy)

#sorted list of System Entropy for all possible dates
systemEntropy = sorted(listSystemEntropy)
print(systemEntropy)

#------Calculating Average user breadth of attention----------
listUserEntropy = []
#Grouping the dataframe based on date and iterating over it
for i, timedf in df.groupby(['time']):
    userEntropy = 0

    #Count of total number of users posting memes in a day
    totalUser = timedf['user'].unique().__len__()

    avgUserEntropy = 0

    #Further grouping the dataframe based on Users
    for j, usertimedf in timedf.groupby(['user']):
        #count of memes posted by a user per day
        n = usertimedf['time'].__len__()
        userTagList = usertimedf['hashtag'].unique()

        #Iterating over all the hashtags for a particular date and user
        for tag in userTagList:
            ci = usertimedf[usertimedf['hashtag'] == tag].__len__()

            #calculating entropy for c(i) != 0
            if ci != 0:
                #proportion of a meme by a user per day
                fi = ci / n
                #entropy for a single user
                s = -(fi * m.log10(fi))

                #adding entropy of all the users for a particular day
                userEntropy = userEntropy + s

    #Calculating average user Entropy for a particular date
    avgUserEntropy = userEntropy / totalUser

    listUserEntropy.append(avgUserEntropy)

#List of User Entropy ready to be plotted.
finalUserEntropy = sorted(listUserEntropy)
print(finalUserEntropy)

#Compling takes a long time, so these data can be used to plot the graph, this was obtained from the code itself.
# finalUserEntropy = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01308826068104266, 0.013683181621090055, 0.0158436839823148, 0.01623907381331912, 0.019764532812652964, 0.02315615351261394, 0.02489056004753465, 0.025085832971998432, 0.025085832971998432, 0.025130417358515903, 0.025875732653070638, 0.028669523396569637, 0.028672173851853656, 0.029018781071435334, 0.030364157547708166, 0.030764822988939955, 0.032961958272367226, 0.0330945161661985, 0.03385116166464712, 0.03503539466502722, 0.03521786107293961, 0.036701634978435566, 0.03890756251918218, 0.040967181131076814, 0.04146776144310998, 0.042313952080808896, 0.04236392347390931, 0.043302400056368893, 0.04477983846727329, 0.04508376906299237, 0.0462506248306125, 0.04845479866687707, 0.04851152218537752, 0.04906382894805571, 0.04949547156027605, 0.050171665943996864, 0.051090877929346905, 0.05128287313989359, 0.051389583145124984, 0.05153306514791435, 0.05180779920036162, 0.052543255086737205, 0.05301347274662915, 0.05407998717253993, 0.055141679013993354, 0.05558223217026026, 0.055706806853784395, 0.055718962134420603, 0.0565374017779013, 0.05731356164913398, 0.057339046793139274, 0.058308521149318594, 0.058491373663613386, 0.05868318879416491, 0.059669662482884654, 0.05985778849104951, 0.05985778849104951, 0.06010569201694557, 0.06024189845291622, 0.06047610760701772, 0.06047854406708203, 0.06091033355287885, 0.061522372123926576, 0.061556121288159724, 0.06204666039907417, 0.062281059897101865, 0.06261706215915236, 0.06271219085981442, 0.06290127074640216, 0.06314036271308629, 0.0633846989556684, 0.06362861933091442, 0.06364679005338078, 0.06434691331823669, 0.0644314298288868, 0.06448336498493487, 0.06451384443176984, 0.06480091454085946, 0.06489459833083905, 0.06491808956004233, 0.06516729320684905, 0.06522882139315024, 0.06548036595833921, 0.06581565185258485, 0.06582228438295655, 0.06583733891979363, 0.0663156217861572, 0.06638115472463611, 0.06644924507342827, 0.06652680342965589, 0.06668304834794814, 0.06764106032391651, 0.06833793304209367, 0.06836952615320252, 0.06854636221734613, 0.06896413951509123, 0.0691095714818581, 0.06935972330140958, 0.06956737974562033, 0.06959687150004841, 0.06984515997197487, 0.07001452921480854, 0.0701202143573659, 0.07071961124071842, 0.0708305872150544, 0.07089032597153361, 0.07103480759663806, 0.07114256790411855, 0.07180201028178196, 0.07214205283899094, 0.07215066995307043, 0.07218813335707003, 0.0724840639847358, 0.07267113926716136, 0.0729078847001837, 0.07305554253133392, 0.07308180175103188, 0.07324923506048957, 0.07329900014453396, 0.07332883639462301, 0.073464459106338, 0.07350760929568716, 0.0735629913485926, 0.07448060697667598, 0.07470917081306329, 0.0747944809761165, 0.07488113094535641, 0.07488167745603036, 0.07535172127702801, 0.0753642126692618, 0.07540653735290473, 0.07548836741764384, 0.07561692688036117, 0.07585572787635758, 0.07600138323939283, 0.07622768308312727, 0.07634804353808941, 0.07635766796747231, 0.07636898005690626, 0.07667937994660912, 0.07708641627125026, 0.07710045172024091, 0.0771191513047354, 0.0771998512808002, 0.07765901976435113, 0.07784076545655076, 0.0778963920984429, 0.07803015497738443, 0.07805175375907424, 0.07814531337212394, 0.07823479057307572, 0.07825190068209287, 0.0782569050627157, 0.07826779887263512, 0.07826844319719252, 0.07830552810373348, 0.07847951142317704, 0.078582522341765, 0.07860707501758954, 0.07881360625162816, 0.07882231588330942, 0.07883308077244079, 0.07895947270466247, 0.07896239349367275, 0.07898344220921968, 0.07903352336179655, 0.07916010225310528, 0.07924836838132863, 0.07934615528202886, 0.07948781472337274, 0.07952592367822255, 0.0798031924126664, 0.07981149008189113, 0.08013099442661513, 0.08014554830961247, 0.08023555156585227, 0.08047692085608013, 0.08057996212033502, 0.08065084940741564, 0.08070919354773959, 0.08086891340032784, 0.08105039365763428, 0.08113356929796212, 0.08123523604757252, 0.081466951773736, 0.08153965839282674, 0.08166956896336035, 0.08188117010999937, 0.08195594614812714, 0.08203649525254444, 0.08214442820029148, 0.08216836368958717, 0.08244648635851153, 0.08247847421516805, 0.08259466621526859, 0.0826819597116508, 0.08274562876447426, 0.08294718077283952, 0.0830124984776192, 0.08310297931876752, 0.08319738343073346, 0.08342945866260758, 0.08343454178489372, 0.08370030069962285, 0.08398987416484857, 0.08399619200826917, 0.08400386683998672, 0.0840584680552083, 0.08417405295389413, 0.08418754475493948, 0.0842452051467963, 0.08427822576188088, 0.08429716687973635, 0.08431817351346489, 0.08443981416410769, 0.0845835908487669, 0.08460354934408759, 0.08465957192903885, 0.08467506095228337, 0.08487685691547356, 0.08502965565506884, 0.08509630867780951, 0.08510345284508025, 0.08535988474645223, 0.08536728228703765, 0.08568489733804581, 0.08576457616020992, 0.08584289620172177, 0.085906572557642, 0.08596392257699186, 0.08618026528386, 0.08645083892450454, 0.08647161976008125, 0.08680959010733297, 0.0871402619027314, 0.08719162911921591, 0.0876040162000108, 0.08765195511930801, 0.08776426702853365, 0.0877674546060135, 0.0879666973698713, 0.08843036855324242, 0.08858632026765906, 0.08873094662160487, 0.08880514041255981, 0.08882657884115812, 0.08892391924845287, 0.08893735304339423, 0.08914492509623544, 0.08947539214711867, 0.08955557644208746, 0.08956611433751466, 0.08964593969489036, 0.08977031200780276, 0.0900843051886712, 0.09013996879302347, 0.09023948210254229, 0.09062056043305007, 0.09072731145189765, 0.09187342176294529, 0.09188826468742965, 0.09212451348027849, 0.09217352131479122, 0.09251868693516484, 0.0928852633337087, 0.09318054315994145, 0.09353745781172342, 0.09377046247890934, 0.09422967522484953, 0.09432272527133251, 0.09440990738005758, 0.09568466078274543, 0.09592428352461357, 0.09637913296498972, 0.09675835792187958, 0.09676385316674924, 0.09679845632521789, 0.09681560852973135, 0.09704002450321958, 0.09840642505048618, 0.09888940517256602, 0.09966022572179456, 0.10054199783732821, 0.10064607784231715, 0.10065162226277163, 0.10065877183851636, 0.10089055949789787, 0.10158893284164995, 0.10169783627281423, 0.10199532978925153, 0.10223703006718592, 0.10433858688881316, 0.10436081012620207, 0.10447848381697711, 0.10528506221944438, 0.10545044013382418, 0.10697213828513258, 0.10751536334820684, 0.10782660208087408, 0.10797860210411617, 0.10802769728506048, 0.10818947776106323, 0.10889453638697649, 0.10910969072793514, 0.10991584324223573, 0.1104979594287879, 0.11068738650693118, 0.1120401653472987, 0.11219516851502907, 0.11438958244436377, 0.11462501005828786, 0.11645355808114966, 0.11721883913731025, 0.11760522905192222, 0.11829133899167028, 0.11929035136529574, 0.12017032371090076, 0.12025348708610407, 0.1203521059447973, 0.12210952514410778, 0.12359739890832024, 0.12368705273264348, 0.12380709531884392, 0.12499006639118065, 0.12674493611791693, 0.12705237720506088, 0.12747638784933812, 0.1304024381153258, 0.13159263913504163, 0.14321902129371117, 0.1450242825335587, 0.27643459094367495, 0.3010299956639812, 0.3010299956639812, 0.4771212547196624]
# systemEntropy = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.27643459094367495, 0.3010299956639812, 0.3010299956639812, 0.3010299956639812, 0.3010299956639812, 0.3010299956639812, 0.4126972515042213, 0.4771212547196624, 0.4771212547196624, 0.587290334064031, 0.5971986070989108, 0.6989700043360187, 0.6989700043360187, 0.6989700043360187, 0.7470866712473143, 0.8177807547905455, 0.8343433801317222, 0.8358456268135125, 0.8628265920999466, 0.8795880017344074, 0.9213987460487804, 0.9286941242059255, 0.9317278705860013, 0.9448749728329047, 0.9592097670602553, 0.9719740891435643, 0.9866599586738646, 1.0161143562094732, 1.040005172075752, 1.041392685158225, 1.0461614866663989, 1.0536049848239342, 1.0608222860902654, 1.0659996512124768, 1.0968770044586433, 1.1031237505833833, 1.1170435263494498, 1.1214813959193146, 1.1548783509550808, 1.1549291732153126, 1.155797865130105, 1.157565975777938, 1.1806210531488726, 1.1950336277707467, 1.201533532350092, 1.2150558873972908, 1.21537886502357, 1.2304489213782739, 1.2315618205872878, 1.2380824814051663, 1.2529756185803318, 1.2797807842221203, 1.2966430335102284, 1.3004202548641963, 1.3083584386356315, 1.3108178293793629, 1.3111906991663014, 1.3136085884779374, 1.3222991678692284, 1.3431262413054978, 1.3530336118131148, 1.3558076921594397, 1.3566238155314068, 1.3583071656844055, 1.3644682095669916, 1.3644828749372662, 1.3686610409455904, 1.3864699781111571, 1.393273916914726, 1.4136505959057768, 1.4243294412629903, 1.42548611381872, 1.447833720147692, 1.4486389417103671, 1.4743923162537589, 1.488807525945977, 1.4905044279408708, 1.4920212269012472, 1.5132443252700516, 1.5135924540130563, 1.545179292386161, 1.5597807818598428, 1.5608388971271336, 1.5624627245346765, 1.583167431069191, 1.5918462630630204, 1.6452141496996777, 1.663367140756304, 1.6643550143767625, 1.692479941711515, 1.7151727109814119, 1.7217476865037196, 1.739788147662672, 1.7436809664912922, 1.7446646927192597, 1.756958881017314, 1.7857459096169817, 1.79111727968644, 1.8135136253426511, 1.8299917637429433, 1.844006708708135, 1.8440472802889838, 1.8542101496399217, 1.8547425800794346, 1.8697340507711422, 1.8743961154252873, 1.8930308003655876, 1.9009932498381894, 1.90270052207851, 1.9627221312725383, 1.9674260944459399, 1.9747018886614156, 1.9821275582907174, 2.0107807601621066, 2.0244014123919514, 2.033218728313409, 2.038671229859779, 2.048206535779341, 2.0552309268176314, 2.060536520422611, 2.0630773510606875, 2.07161525928082, 2.0765146677112063, 2.079520300535539, 2.0832540255891527, 2.0838621407218234, 2.0923661783801766, 2.0999475351490546, 2.117166778188577, 2.1436584565593164, 2.1554273578138163, 2.1599047253514905, 2.198905176226652, 2.212625916031151, 2.2143768414439844, 2.2175385703039034, 2.2186249252277483, 2.221735399633764, 2.2334353964668523, 2.2369572407184495, 2.2476830355423365, 2.2518759852392765, 2.2696124992177746, 2.273944639481057, 2.274609862448121, 2.276255783884435, 2.278171596402959, 2.284960768313702, 2.302876377202251, 2.3046667402226304, 2.3131633057708663, 2.3332860880639807, 2.344367847516438, 2.353447152452183, 2.3540921222757913, 2.358538398889636, 2.3864611365557935, 2.41288656145565, 2.416747762844492, 2.41898452974554, 2.4209182232779742, 2.4264118188783463, 2.434382300965437, 2.444230996801505, 2.4521679869206796, 2.4609881822044555, 2.470067272826159, 2.4723548513974576, 2.473509816611346, 2.4756818848653195, 2.4838668235869967, 2.484347561552989, 2.484767681064955, 2.4890470788593007, 2.4896601072187754, 2.4934957067865984, 2.4993962613883984, 2.501964824914054, 2.502558731748146, 2.510794731980041, 2.5191776019893957, 2.5228745560821264, 2.5249949289656763, 2.532212652727588, 2.533280642159563, 2.538552498665414, 2.5398943954229405, 2.5605137331011147, 2.5623240026402287, 2.5629850435773602, 2.5657584320385993, 2.566226645089269, 2.5671792697008957, 2.5692950234443614, 2.57258059375209, 2.590873676043873, 2.5995832556392675, 2.6012554731782984, 2.6056558681859316, 2.611855422253458, 2.6213483052169213, 2.626155669437759, 2.630139173600477, 2.63307083181598, 2.6345500203359262, 2.644355480170023, 2.669664345876363, 2.675235191506553, 2.6767689075766326, 2.681248625482473, 2.685461434144297, 2.685835302596842, 2.6955409631463967, 2.6960348826845704, 2.7042860003665514, 2.710225166623806, 2.7253127892385427, 2.731198822393691, 2.736352509530602, 2.7439989247918293, 2.754959135357404, 2.7565399486863242, 2.7607458908524265, 2.7762695737919065, 2.7767967903443496, 2.7800785328871966, 2.780403529598174, 2.7810450149809305, 2.7862280602454694, 2.7871564165204505, 2.7881053670146363, 2.788806959515678, 2.7912038465211286, 2.7978370344988206, 2.800000873107554, 2.8002153426770766, 2.801384348143069, 2.803648971828041, 2.810202834821086, 2.813081811294181, 2.814915021455918, 2.8150540129820234, 2.815700410199041, 2.819579507172522, 2.8209753393560586, 2.8210042198550216, 2.825748454179203, 2.828006730264609, 2.8301044462646034, 2.8414525706249583, 2.8435950163925465, 2.8580670030227684, 2.8593973587920534, 2.864608442944438, 2.8720598936626285, 2.875976947249649, 2.8779771200291013, 2.879873549107424, 2.8985060903464914, 2.8988868066992333, 2.903566901751529, 2.906783239275759, 2.9118321456296585, 2.9200571362671224, 2.921631479823162, 2.925166383413191, 2.935438882810719, 2.941049307312218, 2.9507028016797565, 2.9688164195748947, 2.970025507079554, 2.9984877897587725, 3.000822239028453, 3.009779952563942, 3.0228581973249438, 3.022869196408976, 3.024926358341264, 3.0348159495879856, 3.041533656787841, 3.0434373345356236, 3.0464085913451164, 3.047747127236961, 3.0495824242773977, 3.057994064031016, 3.068760471718258, 3.0854672111312835, 3.085693641084752, 3.089014199997786, 3.091949914409912, 3.092165090280606, 3.0933176928217905, 3.103752558694155, 3.1044726436077257, 3.105188921381521, 3.1156643843888396, 3.1168473002908628, 3.1223679769102803, 3.146477549654906, 3.1482501358496386, 3.148816161970555, 3.1490512399080846, 3.151469485373307, 3.152833089302079, 3.1595350008092953, 3.1612943155870146, 3.1648979942911293, 3.1702782774034017, 3.1750229308760476, 3.2012994925578324, 3.202132209507242, 3.2061268043254163, 3.2181538944791015, 3.226417634964858, 3.233624894115878, 3.234226253534597, 3.2387317589481848, 3.2494020462491315, 3.2560160019083924, 3.256440088717456, 3.26678598604206, 3.2727533376045526, 3.2826442488245537, 3.283239451477206, 3.2872756585251395, 3.2894083247903088, 3.3087441574739684, 3.3179827269388884, 3.3450839231855745, 3.381899509358157, 3.3820002494373647, 3.4072382196864868, 3.4115703315455788, 3.4115828912939445, 3.4161415556379953, 3.4274397126503473, 3.4499764958838095, 3.4557959951717776, 3.465111036368599, 3.4892720699605952, 3.490996379112019, 3.500993549495447, 3.509346932206337, 3.526321686615132, 3.5490158291485376, 3.5649543323288886, 3.5825908523827454, 3.5859410539485395]

#Setting up x axis as "Days in our observation period ranked from low to high system entropy"
x_axis = np.arange(start = 0,stop=len(uniqueDate))

# Plotting the entropy values
plt.scatter(x_axis, sorted(systemEntropy), color='red')
plt.scatter(x_axis,finalUserEntropy , color='blue')
plt.ylim([0,13])
plt.xlabel('Rank')
plt.ylabel('Entropy')
plt.title('Day-wise entropy values')
plt.legend(labels=['System entropy','Avg User Entropy'])
plt.show()

#Interpretation:
#Comparing the graph obtained from the code and the one provided by in the slides, we can observe that it is very similar, hence the original interpretation from the author
# i.e, User breadth of attention is constant and independent of the system Entropy